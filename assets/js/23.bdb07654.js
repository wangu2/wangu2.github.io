(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{423:function(s,e,t){"use strict";t.r(e);var n=t(27),a=Object(n.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"配置-openvpn-密码认证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-openvpn-密码认证"}},[s._v("#")]),s._v(" 配置 OpenVPN 密码认证")]),s._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#开始安装"}},[s._v("开始安装")])]),t("li",[t("a",{attrs:{href:"#下载密码认证脚本"}},[s._v("下载密码认证脚本")]),t("ul",[t("li",[t("a",{attrs:{href:"#修改脚本配置"}},[s._v("修改脚本配置")])]),t("li",[t("a",{attrs:{href:"#创建密码文件"}},[s._v("创建密码文件")])])])]),t("li",[t("a",{attrs:{href:"#配置-openvpn-server"}},[s._v("配置 OpenVPN Server")])]),t("li",[t("a",{attrs:{href:"#配置-openvpn-client"}},[s._v("配置 OpenVPN Client")])]),t("li",[t("a",{attrs:{href:"#进行认证测试"}},[s._v("进行认证测试")])])])]),t("p"),s._v(" "),t("h2",{attrs:{id:"开始安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开始安装"}},[s._v("#")]),s._v(" 开始安装")]),s._v(" "),t("p",[t("strong",[s._v("所涉及的文件、目录等信息")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("安装目录")]),s._v("："),t("code",[s._v("/root/tools")])]),s._v(" "),t("li",[t("strong",[s._v("配置目录")]),s._v("："),t("code",[s._v("/root/tools/openvpn-server")])]),s._v(" "),t("li",[t("strong",[s._v("证书生成目录")]),s._v("："),t("code",[s._v("/root/tools/openvpn-2.2.2/easy-rsa/2.0/keys")])]),s._v(" "),t("li",[t("strong",[s._v("OpenVPN Server IP")]),s._v("："),t("code",[s._v("47.100.XXX.XXX")])]),s._v(" "),t("li",[t("strong",[s._v("Server 所需文件")]),s._v("："),t("code",[s._v("aliyun.key、aliyun.csr、aliyun.crt、dh1024.pem、ca.crt")])]),s._v(" "),t("li",[t("strong",[s._v("Client 所需文件")]),s._v("："),t("code",[s._v("client.key、client.csr、client.crt、ca.crt")])]),s._v(" "),t("li",[t("strong",[s._v("下载地址")]),s._v("："),t("a",{attrs:{href:"http://oss.aliyuncs.com/aliyunecs/openvpn-2.2.2.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[s._v("OpenVPN Server"),t("OutboundLink")],1),s._v("、"),t("a",{attrs:{href:"https://www.techspot.com/downloads/5182-openvpn.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("OpenVPN Client"),t("OutboundLink")],1),s._v("、"),t("a",{attrs:{href:"https://dl.t2.re/Others/OpenVPN/checkpsw.sh",target:"_blank",rel:"noopener noreferrer"}},[s._v("密码认证脚本"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("strong",[s._v("用户验证文件")]),s._v("："),t("code",[s._v("psw-file")])])]),s._v(" "),t("h2",{attrs:{id:"下载密码认证脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载密码认证脚本"}},[s._v("#")]),s._v(" 下载密码认证脚本")]),s._v(" "),t("p",[s._v("进入目录 "),t("code",[s._v("/root/tools/openvpn-server")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载认脚本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://dl.t2.re/Others/OpenVPN/checkpsw.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"修改脚本配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改脚本配置"}},[s._v("#")]),s._v(" 修改脚本配置")]),s._v(" "),t("p",[t("code",[s._v("vim /root/tools/openvpn-server/checkpsw.sh")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户、密码存放位置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PASSFILE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/root/tools/openvpn-server/psw-file"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 增加执行权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /root/tools/openvpn-server/checkpsw.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"创建密码文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建密码文件"}},[s._v("#")]),s._v(" 创建密码文件")]),s._v(" "),t("p",[t("code",[s._v("vim /root/tools/openvpn-server/psw-file")]),s._v("。用户密码格式为："),t("code",[s._v("username password")]),s._v("，一行一位。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# li 为 username, 4040 为 password")]),s._v("\nli "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4040")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" /root/tools/openvpn-server/psw-file\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("对于文件的权限赋予很重要")]),s._v(" "),t("p",[s._v("checkpsw.sh、psw-file")])]),s._v(" "),t("h2",{attrs:{id:"配置-openvpn-server"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-openvpn-server"}},[s._v("#")]),s._v(" 配置 OpenVPN Server")]),s._v(" "),t("p",[s._v("在 Server.conf 尾部追加代码段，"),t("code",[s._v("vim /root/tools/openvpn-server/server.conf")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# OpenVPN 账号密码认证脚本")]),s._v("\nauth-user-pass-verify /root/tools/openvpn-server/checkpsw.sh via-env\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用客户端提供的用户名作为common name")]),s._v("\nusername-as-common-name\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 脚本运行级别为3，否则无法认证用户名密码")]),s._v("\nscript-security "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h2",{attrs:{id:"配置-openvpn-client"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-openvpn-client"}},[s._v("#")]),s._v(" 配置 OpenVPN Client")]),s._v(" "),t("p",[s._v("在客户端 "),t("code",[s._v(".ovpn")]),s._v(" 配置文件中追加")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户认证")]),s._v("\nauth-user-pass\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"进行认证测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#进行认证测试"}},[s._v("#")]),s._v(" 进行认证测试")]),s._v(" "),t("p",[s._v("启动 Server: "),t("code",[s._v("/usr/local/sbin/openvpn --config /root/tools/openvpn-server server.conf &")])]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20201023172806.png",alt:"img"}})]),s._v(" "),t("p",[s._v("启动 Client 右击连接时，会弹出密码认证的窗口。填写正确的密码即可登录")]),s._v(" "),t("p",[t("img",{attrs:{src:"/img/image-20201023173212.png",alt:"img"}})])])}),[],!1,null,null,null);e.default=a.exports}}]);