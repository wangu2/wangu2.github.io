<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>搭建 OpenVPN | YOU CAN DO IT @ WANGU</title>
    <meta name="generator" content="VuePress 1.5.4">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.57b1b43f.css" as="style"><link rel="preload" href="/assets/js/app.7efbe7ba.js" as="script"><link rel="preload" href="/assets/js/2.6911186c.js" as="script"><link rel="preload" href="/assets/js/22.6918c566.js" as="script"><link rel="prefetch" href="/assets/js/10.0dd62fe5.js"><link rel="prefetch" href="/assets/js/11.79010c3f.js"><link rel="prefetch" href="/assets/js/12.3e4763f5.js"><link rel="prefetch" href="/assets/js/13.7e1a5336.js"><link rel="prefetch" href="/assets/js/14.3fa1a476.js"><link rel="prefetch" href="/assets/js/15.f9994be5.js"><link rel="prefetch" href="/assets/js/16.289306ba.js"><link rel="prefetch" href="/assets/js/17.90f30f83.js"><link rel="prefetch" href="/assets/js/18.745e118b.js"><link rel="prefetch" href="/assets/js/19.bfba5612.js"><link rel="prefetch" href="/assets/js/20.e6073ffb.js"><link rel="prefetch" href="/assets/js/21.53c46aba.js"><link rel="prefetch" href="/assets/js/23.bdb07654.js"><link rel="prefetch" href="/assets/js/24.2208129a.js"><link rel="prefetch" href="/assets/js/25.7bfd10bc.js"><link rel="prefetch" href="/assets/js/26.9d2bd670.js"><link rel="prefetch" href="/assets/js/3.b0fe903f.js"><link rel="prefetch" href="/assets/js/4.9b4a50d5.js"><link rel="prefetch" href="/assets/js/5.5f3bf129.js"><link rel="prefetch" href="/assets/js/6.defbe399.js"><link rel="prefetch" href="/assets/js/7.7077d182.js"><link rel="prefetch" href="/assets/js/8.8142661f.js"><link rel="prefetch" href="/assets/js/9.67779462.js">
    <link rel="stylesheet" href="/assets/css/0.styles.57b1b43f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">YOU CAN DO IT @ WANGU</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基本的" class="dropdown-title"><span class="title">基本的</span> <span class="arrow down"></span></button> <button type="button" aria-label="基本的" class="mobile-dropdown-title"><span class="title">基本的</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/1-base/java/java-oop.html" class="nav-link">
  Java 基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java Spring" class="dropdown-title"><span class="title">Java Spring</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java Spring" class="mobile-dropdown-title"><span class="title">Java Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          编辑器
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/#2" class="nav-link">
  //TODO IntelliJ IDEA
</a></li></ul></li><li class="dropdown-item"><h4>
          Spring Boot
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/2-java-spring/Spring/SpringBoot/IDEA创建SpringBoot/1-idea-create-springboot.html" class="nav-link">
  Spring Boot - 多模块项目创建
</a></li><li class="dropdown-subitem"><a href="/#3" class="nav-link">
  //TODO Spring Boot - Helloword
</a></li><li class="dropdown-subitem"><a href="/#4" class="nav-link">
  //TODO Spring Boot - 多配置文件
</a></li><li class="dropdown-subitem"><a href="/#5" class="nav-link">
  //TODO Spring Boot - LogBack日志配置
</a></li><li class="dropdown-subitem"><a href="/#6" class="nav-link">
  //TODO Spring Boot - Swagger UI
</a></li></ul></li><li class="dropdown-item"><h4>
          Spring Security
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/#7" class="nav-link">
  //TODO 初始化
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/3-java-extends/中间件/RabbitMQ消息中间件/1-RabbitMQ-setup.html" class="nav-link">
  RabbitMQ 消息队列
</a></li><li class="dropdown-item"><!----> <a href="/3-java-extends/中间件/SpringBoot2.0集成Activiti6/1-springboot-activit-star.html" class="nav-link">
  Activiti6 工作流引擎
</a></li><li class="dropdown-item"><!----> <a href="/#8" class="nav-link">
  //TODO Shardingsphere 分库分表
</a></li><li class="dropdown-item"><!----> <a href="/#9" class="nav-link">
  //TODO Mybaits-Plus ORM 数据持久
</a></li><li class="dropdown-item"><!----> <a href="/#10" class="nav-link">
  //TODO Druid 连接池
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="翻过这座山" class="dropdown-title"><span class="title">翻过这座山</span> <span class="arrow down"></span></button> <button type="button" aria-label="翻过这座山" class="mobile-dropdown-title"><span class="title">翻过这座山</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/5-up/第一阶段/1-Mybaits源码解析.html" class="nav-link">
  1.1.持久层框架设计实现及MyBatis源码分析
</a></li><li class="dropdown-item"><!----> <a href="/5-up/第一阶段/2-IoC容器设计及Spring源码.html" class="nav-link">
  1.2.IoC容器设计实现及Spring源码分析
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/6-tools/OpenVPN/1-搭建-OpenVPN.html" class="nav-link">
  服务器搭建 OpenVPN
</a></li></ul></div></div><div class="nav-item"><a href="/6-tools/0-小工具集合.html" class="nav-link">
  集
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🏀" class="dropdown-title"><span class="title">🏀</span> <span class="arrow down"></span></button> <button type="button" aria-label="🏀" class="mobile-dropdown-title"><span class="title">🏀</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/0-life/basketball/1-day1.html" class="nav-link">
  球性训练计划
</a></li></ul></div></div><div class="nav-item"><a href="/关于.html" class="nav-link">
  关于
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基本的" class="dropdown-title"><span class="title">基本的</span> <span class="arrow down"></span></button> <button type="button" aria-label="基本的" class="mobile-dropdown-title"><span class="title">基本的</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/1-base/java/java-oop.html" class="nav-link">
  Java 基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java Spring" class="dropdown-title"><span class="title">Java Spring</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java Spring" class="mobile-dropdown-title"><span class="title">Java Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          编辑器
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/#2" class="nav-link">
  //TODO IntelliJ IDEA
</a></li></ul></li><li class="dropdown-item"><h4>
          Spring Boot
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/2-java-spring/Spring/SpringBoot/IDEA创建SpringBoot/1-idea-create-springboot.html" class="nav-link">
  Spring Boot - 多模块项目创建
</a></li><li class="dropdown-subitem"><a href="/#3" class="nav-link">
  //TODO Spring Boot - Helloword
</a></li><li class="dropdown-subitem"><a href="/#4" class="nav-link">
  //TODO Spring Boot - 多配置文件
</a></li><li class="dropdown-subitem"><a href="/#5" class="nav-link">
  //TODO Spring Boot - LogBack日志配置
</a></li><li class="dropdown-subitem"><a href="/#6" class="nav-link">
  //TODO Spring Boot - Swagger UI
</a></li></ul></li><li class="dropdown-item"><h4>
          Spring Security
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/#7" class="nav-link">
  //TODO 初始化
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/3-java-extends/中间件/RabbitMQ消息中间件/1-RabbitMQ-setup.html" class="nav-link">
  RabbitMQ 消息队列
</a></li><li class="dropdown-item"><!----> <a href="/3-java-extends/中间件/SpringBoot2.0集成Activiti6/1-springboot-activit-star.html" class="nav-link">
  Activiti6 工作流引擎
</a></li><li class="dropdown-item"><!----> <a href="/#8" class="nav-link">
  //TODO Shardingsphere 分库分表
</a></li><li class="dropdown-item"><!----> <a href="/#9" class="nav-link">
  //TODO Mybaits-Plus ORM 数据持久
</a></li><li class="dropdown-item"><!----> <a href="/#10" class="nav-link">
  //TODO Druid 连接池
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="翻过这座山" class="dropdown-title"><span class="title">翻过这座山</span> <span class="arrow down"></span></button> <button type="button" aria-label="翻过这座山" class="mobile-dropdown-title"><span class="title">翻过这座山</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/5-up/第一阶段/1-Mybaits源码解析.html" class="nav-link">
  1.1.持久层框架设计实现及MyBatis源码分析
</a></li><li class="dropdown-item"><!----> <a href="/5-up/第一阶段/2-IoC容器设计及Spring源码.html" class="nav-link">
  1.2.IoC容器设计实现及Spring源码分析
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/6-tools/OpenVPN/1-搭建-OpenVPN.html" class="nav-link">
  服务器搭建 OpenVPN
</a></li></ul></div></div><div class="nav-item"><a href="/6-tools/0-小工具集合.html" class="nav-link">
  集
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="🏀" class="dropdown-title"><span class="title">🏀</span> <span class="arrow down"></span></button> <button type="button" aria-label="🏀" class="mobile-dropdown-title"><span class="title">🏀</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/0-life/basketball/1-day1.html" class="nav-link">
  球性训练计划
</a></li></ul></div></div><div class="nav-item"><a href="/关于.html" class="nav-link">
  关于
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/6-tools/OpenVPN/1-搭建-OpenVPN.html" class="active sidebar-link">搭建 OpenVPN</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/6-tools/OpenVPN/1-搭建-OpenVPN.html#openvpn-ssl协议" class="sidebar-link">OpenVPN - SSL协议</a></li><li class="sidebar-sub-header"><a href="/6-tools/OpenVPN/1-搭建-OpenVPN.html#开始安装" class="sidebar-link">开始安装</a></li><li class="sidebar-sub-header"><a href="/6-tools/OpenVPN/1-搭建-OpenVPN.html#生成与配置证书" class="sidebar-link">生成与配置证书</a></li><li class="sidebar-sub-header"><a href="/6-tools/OpenVPN/1-搭建-OpenVPN.html#配置-openvpn-server-conf" class="sidebar-link">配置 OpenVPN - Server.conf</a></li><li class="sidebar-sub-header"><a href="/6-tools/OpenVPN/1-搭建-OpenVPN.html#配置-iptables" class="sidebar-link">配置 iptables</a></li><li class="sidebar-sub-header"><a href="/6-tools/OpenVPN/1-搭建-OpenVPN.html#启动-openvpn-server" class="sidebar-link">启动 OpenVPN Server</a></li><li class="sidebar-sub-header"><a href="/6-tools/OpenVPN/1-搭建-OpenVPN.html#启动-openvpn-client" class="sidebar-link">启动 OpenVPN Client</a></li></ul></li><li><a href="/6-tools/OpenVPN/2-配置-OpenVPN密码认证.html" class="sidebar-link">配置 OpenVPN 密码认证</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/6-tools/OpenVPN/2-配置-OpenVPN密码认证.html#开始安装" class="sidebar-link">开始安装</a></li><li class="sidebar-sub-header"><a href="/6-tools/OpenVPN/2-配置-OpenVPN密码认证.html#下载密码认证脚本" class="sidebar-link">下载密码认证脚本</a></li><li class="sidebar-sub-header"><a href="/6-tools/OpenVPN/2-配置-OpenVPN密码认证.html#配置-openvpn-server" class="sidebar-link">配置 OpenVPN Server</a></li><li class="sidebar-sub-header"><a href="/6-tools/OpenVPN/2-配置-OpenVPN密码认证.html#配置-openvpn-client" class="sidebar-link">配置 OpenVPN Client</a></li><li class="sidebar-sub-header"><a href="/6-tools/OpenVPN/2-配置-OpenVPN密码认证.html#进行认证测试" class="sidebar-link">进行认证测试</a></li></ul></li><li><a href="/6-tools/OpenVPN/3-衍生问题.html" class="sidebar-link">衍生问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/6-tools/OpenVPN/3-衍生问题.html#阿里云同vpc、同路由、多交换机" class="sidebar-link">阿里云同VPC、同路由、多交换机</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="搭建-openvpn"><a href="#搭建-openvpn" class="header-anchor">#</a> 搭建 OpenVPN</h1> <blockquote><p>目前环境为多台阿里云的 ECS 服务器，系统为 CentOS</p></blockquote> <p></p><div class="table-of-contents"><ul><li><a href="#openvpn-ssl协议">OpenVPN - SSL协议</a></li><li><a href="#开始安装">开始安装</a><ul><li><a href="#安装依赖">安装依赖</a></li><li><a href="#下载">下载</a></li><li><a href="#编译、安装">编译、安装</a></li><li><a href="#配置-pki-https-baike-baidu-com-item-e5-85-ac-e9-92-a5-e5-9f-ba-e7-a1-80-e8-ae-be-e6-96-bd-10881894-fromtitle-pki-fromid-212376-fr-aladdin-信息">配置 PKI 信息</a></li></ul></li><li><a href="#生成与配置证书">生成与配置证书</a><ul><li><a href="#重载-清除所有证书">重载&amp;清除所有证书</a></li><li><a href="#生成证书-ca-证书">生成证书 CA 证书</a></li><li><a href="#生成-server-所需的秘钥、证书">生成 Server 所需的秘钥、证书</a></li><li><a href="#生成-client-所需的秘钥、证书">生成 Client 所需的秘钥、证书</a></li><li><a href="#复制证书、密钥和参数文件">复制证书、密钥和参数文件</a></li></ul></li><li><a href="#配置-openvpn-server-conf">配置 OpenVPN - Server.conf</a></li><li><a href="#配置-iptables">配置 iptables</a><ul><li><a href="#配置-iptables-前-确保-iptables-已经开启否则无效">配置 iptables 前，确保 iptables 已经开启否则无效</a></li><li><a href="#清除-iptables-规则">清除 iptables 规则</a></li><li><a href="#添加-iptables-规则">添加 iptables 规则</a></li><li><a href="#开启内部-ipv4-路由转发">开启内部 IPv4 路由转发</a></li></ul></li><li><a href="#启动-openvpn-server">启动 OpenVPN Server</a></li><li><a href="#启动-openvpn-client">启动 OpenVPN Client</a><ul><li><a href="#查看网络状态">查看网络状态</a></li></ul></li></ul></div><p></p> <h2 id="openvpn-ssl协议"><a href="#openvpn-ssl协议" class="header-anchor">#</a> OpenVPN - SSL协议</h2> <p>VPN 直译就是虚拟专用通道，是提供给企业之间或者个人与公司之间安全数据传输的隧道 <br> <a href="https://github.com/OpenVPN/easy-rsa" target="_blank" rel="noopener noreferrer">OpenVPN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是一个基于 OpenSSL 库的应用层 VPN 实现。</p> <h2 id="开始安装"><a href="#开始安装" class="header-anchor">#</a> 开始安装</h2> <p><strong>所涉及的文件、目录等信息</strong></p> <ul><li><strong>安装目录</strong>：<code>/root/tools</code></li> <li><strong>配置目录</strong>：<code>/root/tools/openvpn-server</code></li> <li><strong>证书生成目录</strong>：<code>/root/tools/openvpn-2.2.2/easy-rsa/2.0/keys</code></li> <li><strong>OpenVPN Server IP</strong>：<code>47.100.XXX.XXX</code></li> <li><strong>Server 所需文件</strong>：<code>aliyun.key、aliyun.csr、aliyun.crt、dh1024.pem、ca.crt</code></li> <li><strong>Client 所需文件</strong>：<code>client.key、client.csr、client.crt、ca.crt</code></li> <li><strong>下载地址</strong>：<a href="http://oss.aliyuncs.com/aliyunecs/openvpn-2.2.2.tar.gz" target="_blank" rel="noopener noreferrer">OpenVPN Server<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://www.techspot.com/downloads/5182-openvpn.html" target="_blank" rel="noopener noreferrer">OpenVPN Client<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://dl.t2.re/Others/OpenVPN/checkpsw.sh" target="_blank" rel="noopener noreferrer">密码认证脚本<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="安装依赖"><a href="#安装依赖" class="header-anchor">#</a> 安装依赖</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum <span class="token function">install</span> -y lzo lzo-devel openssl openssl-devel pam pam-devel
yum <span class="token function">install</span> -y pkcs11-helper pkcs11-helper-devel
<span class="token function">rpm</span> -qa lzolzo-devel openssl openssl-devel pam pam-devel pkcs11-helper pkcs11-helper-devel
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="下载"><a href="#下载" class="header-anchor">#</a> 下载</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /root/tools
<span class="token function">wget</span> http://oss.aliyuncs.com/aliyunecs/openvpn-2.2.2.tar.gz
<span class="token function">tar</span> -zxvf openvpn-2.2.2.tar.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="编译、安装"><a href="#编译、安装" class="header-anchor">#</a> 编译、安装</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> openvpn-2.2.2
./configure                     <span class="token comment"># 配置</span>
<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>            <span class="token comment"># 编译、安装</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$?</span>                         <span class="token comment"># 0表示没有错误</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="配置-pki-信息"><a href="#配置-pki-信息" class="header-anchor">#</a> 配置 <a href="https://baike.baidu.com/item/%E5%85%AC%E9%92%A5%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD/10881894?fromtitle=PKI&amp;fromid=212376&amp;fr=aladdin" target="_blank" rel="noopener noreferrer">PKI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 信息</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 进入目录</span>
<span class="token builtin class-name">cd</span> easy-rsa/2.0/
<span class="token comment"># 备份原文件</span>
<span class="token function">cp</span> vars vars_<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F<span class="token variable">)</span></span>~
<span class="token comment"># 编辑下列字段</span>
<span class="token function">vim</span> vars

<span class="token builtin class-name">export</span> <span class="token assign-left variable">KEY_COUNTRY</span><span class="token operator">=</span><span class="token string">&quot;CN&quot;</span>                 <span class="token comment"># 所在的国家</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">KEY_PROVINCE</span><span class="token operator">=</span><span class="token string">&quot;JIANGSU&quot;</span>           <span class="token comment"># 所在的省份      </span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">KEY_CITY</span><span class="token operator">=</span><span class="token string">&quot;NANJING&quot;</span>               <span class="token comment"># 所在的城市</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">KEY_ORG</span><span class="token operator">=</span><span class="token string">&quot;EVNBASE&quot;</span>                <span class="token comment"># 所在的组织</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">KEY_EMAIL</span><span class="token operator">=</span><span class="token string">&quot;ENVBASE@126.com&quot;</span>      <span class="token comment"># 邮箱的地址</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="生成与配置证书"><a href="#生成与配置证书" class="header-anchor">#</a> 生成与配置证书</h2> <h3 id="重载-清除所有证书"><a href="#重载-清除所有证书" class="header-anchor">#</a> 重载&amp;清除所有证书</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">source</span> ./vars
./clean-all
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="生成证书-ca-证书"><a href="#生成证书-ca-证书" class="header-anchor">#</a> 生成证书 CA 证书</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./build-ca
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>完成后，keys 目录下会生成 <code>ca.crt</code> 文件</p> <h3 id="生成-server-所需的秘钥、证书"><a href="#生成-server-所需的秘钥、证书" class="header-anchor">#</a> 生成 Server 所需的秘钥、证书</h3> <p>其中 aliyun 是自定义的名字，连续回车确认，最后会有两次交互，输入y确认。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./build-key-server aliyun
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>完成后，keys 目录下会生成 <strong><code>aliyun.key、aliyun.csr、aliyun.crt</code></strong> 文件</p> <h3 id="生成-client-所需的秘钥、证书"><a href="#生成-client-所需的秘钥、证书" class="header-anchor">#</a> 生成 Client 所需的秘钥、证书</h3> <p>执行以下命令创建秘钥与证书，其中 client 是用户名，连续回车确认，最后会有两次交互，输入y确认。 <br>
完成后，keys 目录下会生成 1024 位 RSA 服务器密钥 <strong><code>client.key、client.csr、client.crt</code></strong> 文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./build-key client
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行以下命令，生成用于客户端验证的 Diffie Hellman参数，完成后，keys 目录下会生成 dh 参数文件 <strong><code>dh1024.pem</code></strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./build-dh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="复制证书、密钥和参数文件"><a href="#复制证书、密钥和参数文件" class="header-anchor">#</a> 复制证书、密钥和参数文件</h3> <p>创建配置目录 <code>mkdir /root/tools/openvpn-server</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 复制证书至配置目录</span>
<span class="token function">cp</span> -a /root/tools/openvpn-2.2.2/easy-rsa/2.0/keys/  /root/tools/openvpn-server/

<span class="token comment"># 进入 openvpn 示例代码目录</span>
<span class="token builtin class-name">cd</span> /root/tools/openvpn-2.2.2/sample-config-files/
<span class="token comment"># 复制 server.conf、client.conf 至配置目录</span>
<span class="token function">cp</span> server.conf client.conf /root/tools/openvpn-server/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="配置-openvpn-server-conf"><a href="#配置-openvpn-server-conf" class="header-anchor">#</a> 配置 OpenVPN - Server.conf</h2> <p>切换目录至 <code>/root/tools/openvpn-server/</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 备份原文件</span>
<span class="token function">cp</span> server.conf server.conf_<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%F<span class="token variable">)</span></span>
<span class="token comment"># 开始编辑</span>
<span class="token function">vim</span> server.conf

<span class="token builtin class-name">local</span> <span class="token number">0.0</span>.0.0
port <span class="token number">1194</span>                                           <span class="token comment"># 端口</span>
proto udp                                           <span class="token comment"># 协议</span>
dev tun                                             <span class="token comment"># 采用路由隧道模式 tun</span>
ca /root/tools/openvpn-server/keys/ca.crt           <span class="token comment"># ca 证书文件位置</span>
cert /root/tools/openvpn-serverkeys/aliyun.crt      <span class="token comment"># 服务端公钥名称</span>
key /root/tools/openvpn-serverkeys/aliyun.key       <span class="token comment"># 服务端私钥名称</span>
dh /root/tools/openvpn-serverkeys/dh1024.pem        <span class="token comment"># 交换证书</span>
server <span class="token number">10.8</span>.0.0 <span class="token number">255.255</span>.255.0                       <span class="token comment"># 给客户端分配地址池，注意：不能和VPN服务器内网网段有相同</span>
push <span class="token string">&quot;route 172.19.0.0 255.255.255.0&quot;</span>               <span class="token comment"># 允许客户端访问内网 172.19.0.0 网段</span>
ifconfig-pool-persist ipp.txt                       <span class="token comment"># 地址池记录文件位置</span>
keepalive <span class="token number">10</span> <span class="token number">120</span>                                    <span class="token comment"># 存活时间，10秒ping一次,120 如未收到响应则视为断线</span>
max-clients <span class="token number">100</span>                                     <span class="token comment"># 最多允许100个客户端连接</span>
status openvpn-status.log                           <span class="token comment"># 日志记录位置</span>
verb <span class="token number">3</span>                                              <span class="token comment"># 日志级别等级</span>
client-to-client                                    <span class="token comment"># 客户端与客户端之间支持通信</span>
log /var/log/openvpn.log                            <span class="token comment"># OpenVPN 日志记录位置</span>
persist-key                                         <span class="token comment"># 通过 keepalive 检测超时后，重新启动 VPN，不重新读取 keys，保留第一次使用的 keys。</span>
persist-tun                                         <span class="token comment"># 检测超时后，重新启动VPN，一直保持 tun 是 linkup 的。否则网络会先 linkdown 然后再linkup</span>
duplicate-cn                                        <span class="token comment"># 客户端使用相同的证书和密钥连接VPN，要打开这个选项，否则每个证书只允许一个人连接VPN</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="配置-iptables"><a href="#配置-iptables" class="header-anchor">#</a> 配置 iptables</h2> <h3 id="配置-iptables-前-确保-iptables-已经开启否则无效"><a href="#配置-iptables-前-确保-iptables-已经开启否则无效" class="header-anchor">#</a> 配置 iptables 前，确保 iptables 已经开启否则无效</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum <span class="token function">install</span> -y iptables-services        <span class="token comment"># 安装 iptables-service</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="清除-iptables-规则"><a href="#清除-iptables-规则" class="header-anchor">#</a> 清除 iptables 规则</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>systemctl <span class="token builtin class-name">enable</span> iptables       <span class="token comment"># iptables 启用</span>

iptables -F                     <span class="token comment"># 清除规则链中已有的条目</span>
iptables -X                     <span class="token comment"># 清除预设表filter中使用者自定链中的规则</span>
iptables -Z                     <span class="token comment"># 清空规则链中的数据包计算器和字节计数器</span>

iptables -t nat -F              <span class="token comment"># 清除 nat </span>
iptables -t nat -X
iptables -t nat -Z

iptables -t mangle -F           <span class="token comment"># 清除 mangle</span>
iptables -t mangle -X
iptables -t mangle -Z

iptables -P INPUT ACCEPT        <span class="token comment"># 接收处理数据数据包</span>
iptables -P OUTPUT ACCEPT       <span class="token comment"># 接收处理输出数据包</span>
iptables -P FORWARD ACCEPT      <span class="token comment"># 接收处理转发数据包</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="添加-iptables-规则"><a href="#添加-iptables-规则" class="header-anchor">#</a> 添加 iptables 规则</h3> <h4 id="openvpn-使用"><a href="#openvpn-使用" class="header-anchor">#</a> OpenVPN 使用</h4> <p>这里我们使用到的命令如下</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 配置nat表将vpn网段IP转发到server内网，这很重要</span>
iptables -t nat -I POSTROUTING -s <span class="token number">10.8</span>.0.0/24 -o eth0 -j SNAT --to-source <span class="token number">172.19</span>.89.134

<span class="token comment"># 查看列表</span>
iptables -L -n -t nat

<span class="token comment"># iptables 保存</span>
<span class="token function">service</span> iptables save

<span class="token comment"># 服务器重启以应用</span>
<span class="token function">service</span> iptables restart

<span class="token comment"># 查看状态</span>
systemctl list-unit-files <span class="token operator">|</span> <span class="token function">grep</span> iptables
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">重要: 防火墙一定要开启后再进行上述配置操作</p> <p><strong>10.8.0.0/24 为VPN分配的网段</strong> <br> <strong>172.19.89.134 为当前 OpenVPN Server 安装的服务器 172.19 地址地址私有 ip</strong></p></div> <h3 id="开启内部-ipv4-路由转发"><a href="#开启内部-ipv4-路由转发" class="header-anchor">#</a> 开启内部 IPv4 路由转发</h3> <p>作为路由或者 VPN 服务就必须要开启IP转发功能</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /etc/sysctl.conf

net.ipv4.ip_forward <span class="token operator">=</span> <span class="token number">1</span>     <span class="token comment"># 1开启，0不开</span>
sysctl -p                   <span class="token comment"># 使配置立即生效</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="启动-openvpn-server"><a href="#启动-openvpn-server" class="header-anchor">#</a> 启动 OpenVPN Server</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 选择配置文件并以后台方式运行</span>
/usr/local/sbin/openvpn --config /root/tools/openvpn-server/server.conf <span class="token operator">&amp;</span>

<span class="token comment"># 查看状态</span>
<span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> openvpn
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="启动-openvpn-client"><a href="#启动-openvpn-client" class="header-anchor">#</a> 启动 OpenVPN Client</h2> <p>Windows 环境，首先下载客户端 <a href="https://www.techspot.com/downloads/5182-openvpn.html" target="_blank" rel="noopener noreferrer">OpenVPN Client<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。<br></p> <ol><li><p>将服务器 <code>/root/tools/openvpn-server</code> 目录下的 <code>client.key、client.csr、client.crt、ca.crt</code> <br></p></li> <li><p>下载到 <code>F:\Tools\OpenVPN</code> (我本地安装目录) <br></p></li></ol> <div class="custom-block tip"><p class="custom-block-title">linux 下载文件或上传 (rz, sz 命令)</p> <p>yum -y install lrzsz</p></div> <ol start="3"><li>创建 <code>client.ovpn</code> 文件，配置如下（修改 IP &amp; cert &amp; key 名称）</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>client                              <span class="token comment"># 声明当前VPN是客户端</span>
dev tun                             <span class="token comment"># 使用tun隧道传输协议</span>
proto udp                           <span class="token comment"># 使用udp协议传输数据</span>
remote <span class="token number">47.100</span>.XXX.XXX <span class="token number">1194</span>          <span class="token comment"># -- OpenVPN Server 所安装服务器 IP 地址与端口 (47.100.XXX.XXX)</span>
resolv-retry infinite               <span class="token comment"># 断线自动重新连接，在网络不稳定的情况下非常有用</span>
nobind                              <span class="token comment"># 不绑定本地特定的端口号</span>
persist-key                         <span class="token comment"># 通过 keepalive 检测超时后，重新启动 VPN，不重新读取 keys，保留第一次使用的 keys。</span>
persist-tun                         <span class="token comment"># 检测超时后，重新启动VPN，一直保持 tun 是 linkup 的。否则网络会先 linkdown 然后再linkup</span>
ca ca.crt                           <span class="token comment"># -- OpenVPN Server 服务器上拷贝下 ca.crt 文件</span>
cert mike.crt                       <span class="token comment"># -- OpenVPN Server 服务器上拷贝下 client.crt 文件</span>
key mike.key                        <span class="token comment"># -- OpenVPN Server 服务器上拷贝下 client.key 文件</span>
comp-lzo                            <span class="token comment"># 使用LZO压缩</span>
verb <span class="token number">2</span>                              <span class="token comment"># 日志级别等级</span>
remote-cert-tls server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="4"><li><p>右击 Client 小锁菜单选择导入配置文件，选择上面创建的 <code>client.ovpn</code></p></li> <li><p>右击选择连接，此时 OpenVPN 会分配一个 <code>10.8.0.0</code> 网段的 IP 地址给本机。使用 <code>ipconfig</code> 进行查看</p></li></ol> <blockquote><p>小图标绿了，就代表他已经连接至 OpenVPN Server ( 👽 : 怎么就绿了 )</p></blockquote> <div class="language-SHELL line-numbers-mode"><pre class="language-shell"><code>未知适配器 本地连接:

   连接特定的 DNS 后缀 <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">:</span>
   本地链接 IPv6 地址. <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">:</span> fe80::4d4d:2ef7:3199:a610%26
   IPv4 地址 <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">:</span> <span class="token number">10.8</span>.0.6
   子网掩码  <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">:</span> <span class="token number">255.255</span>.255.252
   默认网关. <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">:</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="6"><li>使用命令 <code>route print</code> 查看路由列表</li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
接口列表
 <span class="token number">26</span><span class="token punctuation">..</span>.00 ff <span class="token number">79</span> <span class="token number">47</span> e2 e8 <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>TAP-Windows Adapter V9
 <span class="token number">12</span><span class="token punctuation">..</span>.6c 4b <span class="token number">90</span> <span class="token number">54</span> ca <span class="token number">19</span> <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>Realtek PCIe GBE Family Controller
  <span class="token number">8</span><span class="token punctuation">..</span>.00 1a 7d da <span class="token number">71</span> <span class="token number">11</span> <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>Bluetooth Device <span class="token punctuation">(</span>Personal Area Network<span class="token punctuation">)</span> <span class="token comment">#2</span>
  <span class="token number">1</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.Software Loopback Interface <span class="token number">1</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>

IPv4 路由表
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
活动路由:
网络目标        网络掩码          网关       接口   跃点数
          <span class="token number">0.0</span>.0.0          <span class="token number">0.0</span>.0.0      <span class="token number">192.168</span>.1.1    <span class="token number">192.168</span>.1.152     <span class="token number">35</span>
          <span class="token number">0.0</span>.0.0        <span class="token number">128.0</span>.0.0         <span class="token number">10.8</span>.0.5         <span class="token number">10.8</span>.0.6    <span class="token number">281</span>
         <span class="token number">10.8</span>.0.0    <span class="token number">255.255</span>.255.0         <span class="token number">10.8</span>.0.5         <span class="token number">10.8</span>.0.6    <span class="token number">281</span>
         <span class="token number">10.8</span>.0.4  <span class="token number">255.255</span>.255.252            在链路上          <span class="token number">10.8</span>.0.6    <span class="token number">281</span>
         <span class="token number">10.8</span>.0.6  <span class="token number">255.255</span>.255.255            在链路上          <span class="token number">10.8</span>.0.6    <span class="token number">281</span>
         <span class="token number">10.8</span>.0.7  <span class="token number">255.255</span>.255.255            在链路上          <span class="token number">10.8</span>.0.6    <span class="token number">281</span>
   <span class="token number">47.100</span>.160.158  <span class="token number">255.255</span>.255.255      <span class="token number">192.168</span>.1.1    <span class="token number">192.168</span>.1.152    <span class="token number">291</span>
        <span class="token number">127.0</span>.0.0        <span class="token number">255.0</span>.0.0            在链路上         <span class="token number">127.0</span>.0.1    <span class="token number">331</span>
        <span class="token number">127.0</span>.0.1  <span class="token number">255.255</span>.255.255            在链路上         <span class="token number">127.0</span>.0.1    <span class="token number">331</span>
  <span class="token number">127.255</span>.255.255  <span class="token number">255.255</span>.255.255            在链路上         <span class="token number">127.0</span>.0.1    <span class="token number">331</span>
        <span class="token number">128.0</span>.0.0        <span class="token number">128.0</span>.0.0         <span class="token number">10.8</span>.0.5         <span class="token number">10.8</span>.0.6    <span class="token number">281</span>
       <span class="token number">172.19</span>.0.0    <span class="token number">255.255</span>.255.0         <span class="token number">10.8</span>.0.5         <span class="token number">10.8</span>.0.6    <span class="token number">281</span>
      <span class="token number">192.168</span>.1.0    <span class="token number">255.255</span>.255.0            在链路上     <span class="token number">192.168</span>.1.152    <span class="token number">291</span>
    <span class="token number">192.168</span>.1.152  <span class="token number">255.255</span>.255.255            在链路上     <span class="token number">192.168</span>.1.152    <span class="token number">291</span>
    <span class="token number">192.168</span>.1.255  <span class="token number">255.255</span>.255.255            在链路上     <span class="token number">192.168</span>.1.152    <span class="token number">291</span>
        <span class="token number">224.0</span>.0.0        <span class="token number">240.0</span>.0.0            在链路上         <span class="token number">127.0</span>.0.1    <span class="token number">331</span>
        <span class="token number">224.0</span>.0.0        <span class="token number">240.0</span>.0.0            在链路上     <span class="token number">192.168</span>.1.152    <span class="token number">291</span>
        <span class="token number">224.0</span>.0.0        <span class="token number">240.0</span>.0.0            在链路上          <span class="token number">10.8</span>.0.6    <span class="token number">281</span>
  <span class="token number">255.255</span>.255.255  <span class="token number">255.255</span>.255.255            在链路上         <span class="token number">127.0</span>.0.1    <span class="token number">331</span>
  <span class="token number">255.255</span>.255.255  <span class="token number">255.255</span>.255.255            在链路上     <span class="token number">192.168</span>.1.152    <span class="token number">291</span>
  <span class="token number">255.255</span>.255.255  <span class="token number">255.255</span>.255.255            在链路上          <span class="token number">10.8</span>.0.6    <span class="token number">281</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>列表中 <code>172.19.0.0 255.255.255.0 10.8.0.5 10.8.0.6 281</code>，已加入 OpenVPN Server 配置的网段内。</p> <h3 id="查看网络状态"><a href="#查看网络状态" class="header-anchor">#</a> 查看网络状态</h3> <p><strong>使用网络追踪命令 tracert，查看网络状态</strong></p> <p>在 OpenVPN 连接状态下，追踪一下 <code>172.19.89.132</code> ( 此 IP 为 OpenVPN Server 所在子网里另外一台机器 )</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token operator">&gt;</span> tracert -d <span class="token number">172.19</span>.89.132

通过最多 <span class="token number">30</span> 个跃点跟踪到 <span class="token number">172.19</span>.89.132 的路由

  <span class="token number">1</span>    <span class="token number">13</span> ms    <span class="token number">12</span> ms    <span class="token number">12</span> ms  <span class="token number">172.19</span>.89.132

跟踪完成。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>以上状态为正常状态，也可以使用另外 <code>ping</code> 的指令来进行查看网络状态</p> <p>也可以简单粗暴直接访问 <a href="https://ip.cn/" target="_blank" rel="noopener noreferrer">ip.cn<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ，地区显示为阿里云，ip 为 OpenVPN Server 所在服务器 ip</p> <blockquote><p>tracert 或 ping 一直超时则代表有问题 🤔</p> <p>我在安装时遇到这个问题，是因为防火墙未开启内部路由无法转发造成的。( 如何开启参考上述章节即可 )</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/6-tools/OpenVPN/2-配置-OpenVPN密码认证.html">
        配置 OpenVPN 密码认证
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.7efbe7ba.js" defer></script><script src="/assets/js/2.6911186c.js" defer></script><script src="/assets/js/22.6918c566.js" defer></script>
  </body>
</html>
